<!DOCTYPE html><html lang="ko" xmlns:th="http://www.thymeleaf.org"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원가입</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .container {
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 300px;
        }
        h2 {
            margin-top: 0;
            text-align: center;
        }
        input[type="text"], input[type="password"], input[type="date"], input[type="email"], input[type="tel"], select {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        button {
            width: 100%;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .link {
            text-align: center;
            margin-top: 10px;
        }
        .link a {
            color: #4CAF50;
            text-decoration: none;
        }
        .error {
            color: red;
            font-size: 12px;
            margin-bottom: 10px;
            text-align: center;
        }
        .success {
            color: green;
            font-size: 12px;
            text-align: center;
            margin-bottom: 10px;
        }
    </style></head><body><div class="container">
    <h2>회원가입</h2>
    <div class="error" id="registerError"></div>
    <div class="success" id="registerSuccess"></div>
    <form method="POST" action="/customer/signup" onsubmit="return false;">
        <input type="text" name="custId" id="registerId" placeholder="ID" onblur="checkIdAvailability()">
        <div id="idCheckResult" style="font-size: 12px; color: red; text-align: center;"></div>

        <input type="password" name="pwd" id="registerPassword" placeholder="Password" onblur="validatePassword()">
        <div id="passwordCheckResult" style="font-size: 12px; color: red; text-align: center;"></div>

        <input type="password" name="confirmPwd" id="registerConfirmPassword" placeholder="Confirm Password" onblur="checkPasswordMatch()">
        <div id="passwordMatchCheck" style="font-size: 12px; color: red; text-align: center;"></div>

        <input type="text" name="name" id="registerName" placeholder="Name">
        <input type="date" name="birthDate" id="registerBirthDate" placeholder="Birth Date">
        <input type="date" name="date" id="registerDate" placeholder="Date">
        <input type="tel" name="mobileNum" id="registerMobile" placeholder="Mobile Number">
        <input type="text" name="mainAddr" id="registerMainAddr" placeholder="Main Address">
        <select name="gender" id="registerGender">
            <option value="">Select Gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
        </select>
        <input type="email" name="email" id="registerEmail" placeholder="Email">
        <input type="checkbox" name="adultChk" id="registerAdultChk"> 성인여부
        <input type="checkbox" name="withdChk" id="registerWithdChk"> Agree to Terms
        <button type="button" onclick="register()">회원가입</button>
    </form>
    <div class="link">
        <a href="/customer/login">Go to Login</a>
    </div></div>

<script>
    function checkIdAvailability() {
        const id = document.getElementById('registerId').value.trim();
        const idCheckResult = document.getElementById('idCheckResult');

        if (!id) {
            idCheckResult.textContent = '아이디를 입력해주세요.';
            return;
        }

        fetch(`/customer/check-id?custId=${encodeURIComponent(id)}`)
            .then(response => response.json())
            .then(data => {
                if (data.available) {
                    idCheckResult.style.color = 'green';
                    idCheckResult.textContent = '사용가능한 아이디입니다!';
                } else {
                    idCheckResult.style.color = 'red';
                    idCheckResult.textContent = '이미 사용중인 아이디입니다.';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                idCheckResult.textContent = 'Error checking ID availability.';
            });
    }

    function validatePassword() {
        const password = document.getElementById('registerPassword').value.trim();
        const passwordCheckResult = document.getElementById('passwordCheckResult');
        const passwordPattern = /^(?=.*[a-z])(?=.*\d)(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{6,15}$/;

        passwordCheckResult.textContent = ''; // Reset the error message

        if (!passwordPattern.test(password)) {
            passwordCheckResult.style.color = 'red';
            passwordCheckResult.textContent = '비밀번호는 6~15자여야 하며, 소문자, 숫자, 특수기호를 하나 이상 포함해야 합니다.';
            return false;
        } else {
            passwordCheckResult.style.color = 'green';
            passwordCheckResult.textContent = '비밀번호가 요구 사항을 충족합니다.';
            return true;
        }
    }

    // 비밀번호 이중체크
    function checkPasswordMatch() {
        const password = document.getElementById('registerPassword').value.trim();
        const confirmPassword = document.getElementById('registerConfirmPassword').value.trim();
        const passwordMatchCheck = document.getElementById('passwordMatchCheck');

        if (password !== confirmPassword) {
            passwordMatchCheck.style.color = 'red';
            passwordMatchCheck.textContent = '비밀번호가 일치하지 않습니다.';
            return false;
        } else {
            passwordMatchCheck.style.color = 'green';
            passwordMatchCheck.textContent = '비밀번호가 일치합니다.';
            return true;
        }
    }

    function register() {
        const id = document.getElementById('registerId').value.trim();
        const password = document.getElementById('registerPassword').value.trim();
        const confirmPassword = document.getElementById('registerConfirmPassword').value.trim();
        const name = document.getElementById('registerName').value.trim();
        const birthDate = document.getElementById('registerBirthDate').value;
        const date = document.getElementById('registerDate').value;

        const mobile = document.getElementById('registerMobile').value.trim();
        const gender = document.getElementById('registerGender').value;
        const email = document.getElementById('registerEmail').value.trim();
        const adultChk = document.getElementById('registerAdultChk').checked ? "Y" : "N";
        const withdChk = document.getElementById('registerWithdChk').checked ? "Y" : "N";

        const errorElement = document.getElementById('registerError');
        const successElement = document.getElementById('registerSuccess');
        errorElement.textContent = '';
        successElement.textContent = '';

        // Check if all fields are filled and terms are agreed to
        if (!id || !password || !confirmPassword || !name || !birthDate || !mobile || !gender || !email || !withdChk) {
            errorElement.textContent = 'Please fill out all fields and agree to the terms.';
            return;
        }

        // Check password validity
        if (!validatePassword()) {
            errorElement.textContent = 'Please correct the errors before proceeding.';
            return;
        }

        // Check password match
        if (!checkPasswordMatch()) {
            errorElement.textContent = 'Please correct the errors before proceeding.';
            return;
        }

        if (!validateEmail(email)) {
            errorElement.textContent = 'Please enter a valid email address.';
            return;
        }

        successElement.textContent = 'Account created successfully! Redirecting to login...';
        setTimeout(() => {
            window.location.href = "/customer/login";
        }, 2000);
    }

    function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
    }
</script></body></html>